<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-overlay-behavior/iron-overlay-backdrop.html">
<link rel="stylesheet" href="../bower_components/components-font-awesome/css/font-awesome.css">

<dom-module id="gig-select">

    <style>

        * {
            box-sizing: border-box;
            font-family: sans-serif;
        }

        ::content option {
            display: none;
        }

        .select {
            position:relative;
        }

        .select .item {
            height: 36px;
            padding: 6px 27px 6px 15px;
            line-height: 1.57142857;
            font-family: sans-serif;
            font-size: 14px;
            color: #76838f;
            background-color: #fff;
            border: 1px solid #e4eaec;
            border-radius: 3px;
            outline: 0;
            cursor: pointer;
            position:relative;
            width: 100%;
        }

        .select .item:hover {
            transition: border .2s linear,color .2s linear,width .2s linear,background-color .2s linear;
            -webkit-transition:  border .2s linear,color .2s linear,width .2s linear,background-color .2s linear;
            background-color: #62a8ea;
            color: white;
        }

        .select .item i {
            position:absolute;
            right: 10px;
            top: 50%;
            width: 10px;
            height: 10px;
            margin-top: -8px;
            display: block;
            color: #a3afb7
        }

        .select .item:hover i {
            color: white;
        }

        .select ul {
            max-height: 200px;
            overflow: auto;
            margin: 0;
            padding: 0;
            display: none;
            box-shadow: 0 -3px 12px rgba(0,0,0,.05);
            position:absolute;
            min-width: 100%;
            top: 100%;
            left: 0;
            margin-top: 5px;
            z-index: 2;
            background: white;
            background-clip: padding-box;
            float: left;
            border: 1px solid #e4eaec;
            transition: .25s
        }

        .select ul.show {
            display: inline-block;
        }

        .select li {
            list-style: none;
            margin: 0;
            padding: 6px 15px;
            color: #76838f;
            cursor: pointer;
            font-size: 14px;
        }

        .select li:hover {
            background-color: #f3f7f9;
        }


    </style>

    <template>


        <content select="option" id="c" hidden$="{{contentHidden}}"></content>

        <div class="select">
            <div class="item" on-click="clickItem">
                <span>{{itemSelected.label}}</span>
                <span hidden$="[[itemSelected]]">[[label]]</span>

                <i class="fa fa-angle-down"></i>
            </div>
            <ul class$="[[showSelect]]">
            <template is="dom-repeat" items="{{items}}">
                <li on-click="selectItem" class$="[[itemClass(item, itemSelected)]]">{{item.label}}</li>
            </template>
            </ul>
        </div>

        <iron-overlay-backdrop hidden$="{{!showSelect}}" id="overlay" on-click="hideSelect"></iron-overlay-backdrop>


        <input type="hidden" name$="[[name]]" value="{{itemSelected.value}}">


    </template>

    <script>
        (function() {

            Array.prototype.remove = function(from, to) {
                var rest = this.slice((to || from) + 1 || this.length);
                this.length = from < 0 ? this.length + from : from;
                return this.push.apply(this, rest);
            };

            var self;

            Polymer({
                is: 'gig-select',
                ready: function() {
                    this.items = Polymer.dom(this.$.c).getDistributedNodes();
                    this.checkSelected(this.items);
                    this.contentHidden = true;
                    this.showSelect = null;
                },
                checkSelected: function(items) {
                    for (var i = 0; i < items.length; i++) {
                        if (items[i].selected) {
                            this.itemSelected = items[i];
                        }

                        if (this.value === items[i].value) {
                            this.itemSelected = items[i];
                        }
                    }
                },
                selectItem: function(e) {

                    if (this.multiple) {

                        if (this.arrayItemsSelected.indexOf(e.model.item) < 0) {
                            this.arrayItemsSelected.push(e.model.item);
                        } else {
                            this.arrayItemsSelected.remove(this.arrayItemsSelected.indexOf(e.model.item))
                        }

                        this._changeArrayValues();

                    } else {
                        this.itemSelected = e.model.item;
                        this.showSelect = null;
                    }

                },
                clickItem: function() {
                    this.showSelect = 'show';

                },
                hideSelect: function() {
                    this.showSelect = null;
                },
                itemClass: function(item, selectedItem) {
                    var className = '';

                    console.log(selectedItem);

                    if (this.multiple && this.arrayItemsSelected) {
                        if (selectedItem.indexOf(item) >= 0) {
                            className = 'active';
                        }
                    }

                    return className;

                },
                _changeArrayValues: function() {


                },
                properties : {
                    items: {
                        type: Array
                    },
                    itemSelected: {
                        type: Object
                    },
                    arrayItemsSelected: {
                        type: Array,
                        value: []
                    },
                    value: {
                        type: String
                    },
                    multiple: {
                        type: Boolean
                    }
                }
            })
        })();
    </script>

</dom-module>